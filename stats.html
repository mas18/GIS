<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Statistiques</title>
    <script src="data/js/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</head>
<body>

<canvas id="oldestClub" width="600" height="200" style="float:left;"></canvas>
<canvas id="youngestClub" width="600" height="200" style="float:left;"></canvas>
<canvas id="averageClub" width="600" height="200" style="float:left;"></canvas>

<script>

    $.get('data/geojson/stade-complete.geojson', function(data) {

        var oldestClub = document.getElementById("oldestClub");
        var youngestClub = document.getElementById("youngestClub");
        var averageClub = document.getElementById("averageClub");

        var options = {
            animation: { duration:1500 },
            responsive:false,
            maintainAspectRatio: false
        };

        var oldestValues = [10000, 10000, 10000, 10000, 10000, 10000], youngestValues = [-10000, -10000, -10000, -10000, -10000, -10000];
        var oldestClubs = ["", "", "", "", "", ""], youngestClubs = ["", "", "", "", "", ""];
        var englandAverage = new Array(), franceAverage = new Array(), spainAverage = new Array(), italyAverage = new Array(), germanyAverage = new Array(), switzerlandAverage = new Array();

        $.each(data.features, function (key, val) {
            switch(val.properties.Country) {
                case "England":
                    getStatistics(englandAverage, "Angleterre - ", 0, val);
                    break;
                case "Spain":
                    getStatistics(spainAverage, "Espagne - ", 2, val);
                    break;
                case "Germany":
                    getStatistics(germanyAverage, "Allemagne - ", 4, val);
                    break;
                case "Italy":
                    getStatistics(italyAverage, "Italie - ", 3, val);
                    break;
                case "France":
                    getStatistics(franceAverage, "France - ", 1, val);
                    break;
                case "Switzerland":
                    getStatistics(switzerlandAverage, "Suisse - ", 5, val);
                    break;
                default:
            }
        });

        oldestValues = [getAge(oldestValues[0]), getAge(oldestValues[1]), getAge(oldestValues[2]), getAge(oldestValues[3]), getAge(oldestValues[4]), getAge(oldestValues[5])];
        youngestValues = [getAge(youngestValues[0]), getAge(youngestValues[1]), getAge(youngestValues[2]), getAge(youngestValues[3]), getAge(youngestValues[4]), getAge(youngestValues[5])];
        averageValues = [getAverage(englandAverage), getAverage(franceAverage), getAverage(spainAverage), getAverage(italyAverage), getAverage(germanyAverage), getAverage(switzerlandAverage)];

        function getAge(year) {
            var date = new Date().getFullYear();
            return date - year;
        }

        function getAverage(average) {
            var sum = 0;
            for(var i = 0; i < average.length; i++) {
                sum += parseInt(average[i], 10);
            }
            return getAge(Math.round(sum/average.length));
        }

        function getStatistics(average, country, position, value) {
            average.push(value.properties.Formed);
            if(value.properties.Formed < oldestValues[position]) {
                oldestValues[position] = value.properties.Formed;
                oldestClubs[position] = country + value.properties.Club_Name;
            }
            if(value.properties.Formed > youngestValues[position]) {
                youngestValues[position] = value.properties.Formed;
                youngestClubs[position] = country + value.properties.Club_Name;
            }
        }

        var oldestClubChart = new Chart(oldestClub, {
            type: 'horizontalBar',
            data: {
                labels: oldestClubs,
                datasets: [{
                    label: 'Club le plus ancien',
                    data: oldestValues,
                    backgroundColor: [ 'rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)' ],
                    borderColor: [ 'rgba(255,99,132,1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)' ],
                    borderWidth: 1
                }]
            },
            options: options
        });

        var youngestClubChart = new Chart(youngestClub, {
            type: 'horizontalBar',
            data: {
                labels: youngestClubs,
                datasets: [{
                    label: 'Club le plus r√©cent',
                    data: youngestValues,
                    backgroundColor: [ 'rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)' ],
                    borderColor: [ 'rgba(255,99,132,1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)' ],
                    borderWidth: 1
                }]
            },
            options: options
        });

        var averageClubChart = new Chart(averageClub, {
            type: 'horizontalBar',
            data: {
                labels: ["Angleterre", "France", "Espagne", "Italie", "Allemagne", "Suisse"],
                datasets: [{
                    label: 'Age moyen',
                    data: averageValues,
                    backgroundColor: [ 'rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)' ],
                    borderColor: [ 'rgba(255,99,132,1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)' ],
                    borderWidth: 1
                }]
            },
            options: options
        });
    });

</script>
</body>
</html>